<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-emotion="css "></style><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><meta data-react-helmet="true" name="viewport" content="initial-scale=1, width=device-width"/><meta name="generator" content="Gatsby 4.11.3"/><title data-react-helmet="true"></title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&amp;display=swap" rel="stylesheet"/><style data-styled="" data-styled-version="5.3.5"></style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .custom-class.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .custom-class.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .custom-class svg,
    h2 .custom-class svg,
    h3 .custom-class svg,
    h4 .custom-class svg,
    h5 .custom-class svg,
    h6 .custom-class svg {
      visibility: hidden;
    }
    h1:hover .custom-class svg,
    h2:hover .custom-class svg,
    h3:hover .custom-class svg,
    h4:hover .custom-class svg,
    h5:hover .custom-class svg,
    h6:hover .custom-class svg,
    h1 .custom-class:focus svg,
    h2 .custom-class:focus svg,
    h3 .custom-class:focus svg,
    h4 .custom-class:focus svg,
    h5 .custom-class:focus svg,
    h6 .custom-class:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 100)
          }), 0)
        }
      }
    })
  </script><link as="script" rel="preload" href="/webpack-runtime-57b6d46803b8cd06bed8.js"/><link as="script" rel="preload" href="/framework-1551f0820f71ffc92df3.js"/><link as="script" rel="preload" href="/app-14217d3ed318d68d2e42.js"/><link as="script" rel="preload" href="/component---src-pages-b-serverless-api-with-netlify-functions-mdx-57469846c1f2707521ce.js"/><link as="fetch" rel="preload" href="/page-data/b/serverless-api-with-netlify-functions/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><p>Over the last few years, serverless applications have been growing in
popularity. There are many use cases in which a serverless solution is more
practical and more convenient than the traditional server solution. In this
post, we’ll look at setting up a serverless Express.js API using Netlify
functions.</p><h3>Overview</h3><p>Before we dive into the code for this demo application, let’s talk about a few
concepts at a high-level.</p><h3>Serverless</h3><p>“Serverless” is a term that is used for what can generally be thought of as a
method of providing backend services on an as-used basis. Rather than setting up
specific infrastructure, or a server, to provide the backend services, you can
utilize a “serverless” provider to handle this functionality instead. This was
first popularized by AWS Lambda but is now a service offered by many other
companies as well, including the one we’ll be looking at today, Netlify.</p><h3>AWS Lambda</h3><p>As mentioned above, <a href="https://aws.amazon.com/lambda">AWS Lambda</a> is the most
popular provider of serverless computing. Here’s how AWS Lamba describes itself
in its own words:</p><blockquote><p>AWS Lambda lets you run code without provisioning or managing servers. You pay
only for the compute time you consume.</p></blockquote><blockquote><p>With Lambda, you can run code for virtually any type of application or backend
service - all with zero administration. Just upload your code and Lambda takes
care of everything required to run and scale your code with high availability.
You can set up your code to automatically trigger from other AWS services or
call it directly from any web or mobile app.</p></blockquote><p>As great as this sounds (and it really is great), setting up an AWS lambda
function can be a tedious process, requiring quite a bit of configuration that
can be easily confusing to someone is who new to serverless functions. If you’re
curious to see for yourself, here’s an
<a href="https://docs.aws.amazon.com/toolkit-for-eclipse/v1/user-guide/lambda-tutorial.html">example tutorial</a>
directly from the AWS docs. But not to worry, that’s why we’re here to talk
about Netlify Functions.</p><h3>Netlify Functions</h3><p><a href="https://www.netlify.com/products/functions">Netlify Functions</a> greatly
simplifies the process for running serverless functions. Using Netlify
Functions, we can simply write our lambda function and drop it into the
functions folder of our Netlify-hosted application. Behind the scenes, Netlify
handles the interaction with AWS for us. We don’t even need an AWS account.
Every Netlify account is set up for this feature out of the box. There’s no
setup, servers, or ops required.</p><p>Let’s see what this looks like in code.</p><h3>The application</h3><p>The code for this demo can be found
<a href="https://github.com/adamgoth/netlify-serverless-demo">here</a>. Since the purpose
of this post is to show how to set up a serverless API, rather than do anything
specific with the API, this particular demo application will serve up an
extremely basic API with two endpoints that don’t do much. I will assume the
reader has some basic familiarity with <a href="https://expressjs.com/">Express.js</a> and
Node as we will be using these to build the API.</p><p>If we take a look at our package dependencies, we have just five packages:</p><p><code class="language-text">nodemon</code> is used to automatically restart our server while we’re working on it
in development</p><p><code class="language-text">express</code> gives us our API framework</p><p><code class="language-text">body-parser</code> is middleware that allows us the parse our request bodies</p><p><code class="language-text">serverless-http</code> allows us to wrap our API for serverless use</p><p><code class="language-text">netlify-lambda</code> is a tool that helps us build our application code so that it
can be consumed correctly by Netlify using Netlify Functions</p><p>The other thing to note in the <code class="language-text">package.json</code> file are the two scripts. We have
<code class="language-text">&quot;start&quot;: &quot;nodemon server-local.js&quot;</code> which is used for development, and
<code class="language-text">&quot;build&quot;: &quot;netlify-lambda build express&quot;</code> which is used to build and deploy.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;netlify-lambda build express&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon server-local.js&quot;</span>
  <span class="token punctuation">}</span></code></pre></div><p>The <code class="language-text">start</code> script is fairly straight forward, it will just execute our
<code class="language-text">server-local.js</code> file which in turn is calling <code class="language-text">express/server.js</code>. This works
for local development, but we need to do additional work in our <code class="language-text">build</code> script
for the application to work as a serverless function once deployed to Netlify.
In the <code class="language-text">build</code> script, we call
<a href="https://github.com/netlify/netlify-lambda#netlify-lambda-build"><code class="language-text">netlify-lambda build</code></a>
which takes a source folder as an argument (<code class="language-text">express</code> in our case) and outputs
it to a built folder. The built folder is where Netlify will look for our
serverless functions. We have a couple of options for how we specify this. We
could specify the designated folder within Netlify’s application settings using
Netlify’s web app, or within our application code, we can specify the designated
folder with a <code class="language-text">netlify.toml</code> configuration file. In our case, we’ll use a
configuration file that lives in our root directory that looks like this:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// netlify.toml</span>

<span class="token punctuation">;</span><span class="token punctuation">[</span>build<span class="token punctuation">]</span>
command <span class="token operator">=</span> <span class="token string">&quot;npm install &amp;&amp; npm run build&quot;</span>
functions <span class="token operator">=</span> <span class="token string">&quot;functions&quot;</span></code></pre></div><p>With our scripts and build configuration accounted for, let’s take a look at the
core of the application.</p><p>The core of the application lives in the <code class="language-text">express/server.js</code> file, and in our
case, is just 29 lines.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token string">&quot;use strict&quot;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> serverless <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;serverless-http&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;body-parser&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/.netlify/functions/server&quot;</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span> <span class="token comment">// path must route to lambda</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/html&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h1&gt;Up and running&lt;/h1&gt;&quot;</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/doSomething&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// maybe do some database interaction or third-party API call here!</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;bad request&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>handler <span class="token operator">=</span> <span class="token function">serverless</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span></code></pre></div><p>If you’ve ever worked with Express.js, this should look pretty familiar to you.
We have two endpoints, one <code class="language-text">GET</code> endpoint at <code class="language-text">/</code> and one <code class="language-text">POST</code> endpoint at
<code class="language-text">/doSomething</code>.</p><p>These endpoints don’t do much, but you could do just about anything you would
normally do with <code class="language-text">GET</code> or <code class="language-text">POST</code> endpoints here. Hit a third-party API, connect
to a database, fire off some sort of transaction, etc.</p><p>The two lines in the application that are specific to using Netlify’s serverless
functions are line 9 and line 29.</p><p>As we specified in our <code class="language-text">netlify.toml</code> configuration file, our function code is
going to live at <code class="language-text">./netlify/functions/server</code>. So we will tell our express app
on line 9 to use our <code class="language-text">router</code> object anytime a request is sent to this server.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/.netlify/functions/server&quot;</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span></code></pre></div><p>Lastly, on line 29, we will utilize the
<a href="https://github.com/dougmoscrop/serverless-http"><code class="language-text">serverless-http</code></a> package to
wrap our application up for serverless use. This means our application can work
as expected without any HTTP server, ports, or sockets.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>handler <span class="token operator">=</span> <span class="token function">serverless</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span></code></pre></div><p>With that, the application is all set to
<a href="https://docs.netlify.com/site-deploys/overview/#deploy-summary">deploy to Netlify</a>.
If you’ve never deployed on Netlify before, you’ll be amazed at how simple it
is. This post won’t go into details but it isn’t much more than authenticating
your GitHub account and selecting the repo and branch to deploy. Once the
application is deployed, you can start accessing the endpoints we created at
<code class="language-text">&lt;your site URL&gt;/.netlify/functions/server/&lt;your endpoint&gt;</code>. We now have a basic
yet fully-functioning API, without having to run or provision a dedicated and
separate server!</p><h3>Wrapping up</h3><p>Hopefully you were able to follow along in creating this Netlify serverless
function. Serverless computing is still a developing and evolving technology but
its popularity continues to grow as more developers find it more suitable to
their needs than traditional server applications.</p><p>The particular use case that led me to using Netlify functions is that I needed
to make a third-party API call from my client application that required a
private API key in the header. With just client-side code, there is no good way
to keep your private API key private. I decided I needed a server to proxy the
request through, but I didn’t want to create and dedicate an entire server just
to pass one small API request through. So this ended up being a perfect
solution. Now that I know how convenient and simple this can be, I will be
looking for more opportunities to utilize Netlify Functions.</p><p>For more technical information regarding the usage and implementation of Netlify
Functions, be sure to visit
<a href="https://docs.netlify.com/functions/overview/#manage-your-serverless-functions">the docs</a>.</p><p>If you enjoyed this post or found it useful, please consider
<a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fwww.adamgoth.com%2Frunning-a-serverless-api-using-netlify-functions">sharing it on Twitter</a>.</p><p>If you want to stay updated on new posts,
<a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fpublish.twitter.com%2F%3FbuttonType%3DFollowButton%26query%3Dhttps%253A%252F%252Ftwitter.com%252Finit_adam%26widget%3DButton&amp;ref_src=twsrc%5Etfw&amp;region=follow_link&amp;screen_name=init_adam&amp;tw_p=followbutton">follow me on Twitter</a>.</p><p>If you have any questions, comments, or just want to say hello,
<a href="https://twitter.com/messages/compose?recipient_id=33618361">send me a message</a>.</p><p>Thanks for reading!</p></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/b/serverless-api-with-netlify-functions/";window.___webpackCompilationHash="4e2f5bc829d58c24e2a9";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-d8e9fe2438665be6e366.js"],"app":["/app-14217d3ed318d68d2e42.js"],"component---src-components-sz-tpl-page-tag-js":["/component---src-components-sz-tpl-page-tag-js-a1ed8bbe0627fe5547d0.js"],"component---src-pages-404-js":["/component---src-pages-404-js-334e9f943f02db1518b4.js"],"component---src-pages-a-hello-world-index-mdx":["/component---src-pages-a-hello-world-index-mdx-beb1bc52d4fbc4b916c4.js"],"component---src-pages-a-my-second-post-index-mdx":["/component---src-pages-a-my-second-post-index-mdx-57197b2e5477f99a809d.js"],"component---src-pages-a-new-beginnings-index-mdx":["/component---src-pages-a-new-beginnings-index-mdx-72424eba1abfa72352bf.js"],"component---src-pages-about-js":["/component---src-pages-about-js-4a38f3d29d1eaa1b9a72.js"],"component---src-pages-b-building-a-blog-with-gatsby-and-mdx-mdx":["/component---src-pages-b-building-a-blog-with-gatsby-and-mdx-mdx-079018f81559a742c563.js"],"component---src-pages-b-serverless-api-with-netlify-functions-mdx":["/component---src-pages-b-serverless-api-with-netlify-functions-mdx-57469846c1f2707521ce.js"],"component---src-pages-b-sz-caption-js":[],"component---src-pages-b-tips-and-tricks-chrome-dev-tools-mdx":["/component---src-pages-b-tips-and-tricks-chrome-dev-tools-mdx-333ce1dc9c2ee9065616.js"],"component---src-pages-b-venue-broadwater-farm-mdx":["/component---src-pages-b-venue-broadwater-farm-mdx-f7f8229095df9deec911.js"],"component---src-pages-b-venue-lordship-hub-mdx":["/component---src-pages-b-venue-lordship-hub-mdx-7dbece011fa33b93e4ce.js"],"component---src-pages-c-policies-mdx":["/component---src-pages-c-policies-mdx-34748af47df15e996687.js"],"component---src-pages-form-22-js":["/component---src-pages-form-22-js-9192903209dc3f72ef01.js"],"component---src-pages-formik-22-js":["/component---src-pages-formik-22-js-435a06a755eb4d654627.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f713b14ef8e86bd1547b.js"],"component---src-pages-szmdxposts-2-js":["/component---src-pages-szmdxposts-2-js-9249a64066b361b2ad60.js"],"component---src-pages-szmdxposts-js":["/component---src-pages-szmdxposts-js-df5fe8bdc53bb27759c6.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-001f2603dad78a64c76b.js"],"component---src-pages-tmpmenu-js":["/component---src-pages-tmpmenu-js-c2977ecb9a1ccb1f7886.js"],"component---src-pages-tpl-mdx-posts-js":["/component---src-pages-tpl-mdx-posts-js-0b353b4dd7b1e80acd27.js"],"component---src-pages-what-is-a-repair-cafe-js":["/component---src-pages-what-is-a-repair-cafe-js-ac8217e7ec41e5c107c5.js"]};/*]]>*/</script><script src="/polyfill-d8e9fe2438665be6e366.js" nomodule=""></script><script src="/component---src-pages-b-serverless-api-with-netlify-functions-mdx-57469846c1f2707521ce.js" async=""></script><script src="/app-14217d3ed318d68d2e42.js" async=""></script><script src="/framework-1551f0820f71ffc92df3.js" async=""></script><script src="/webpack-runtime-57b6d46803b8cd06bed8.js" async=""></script></body></html>